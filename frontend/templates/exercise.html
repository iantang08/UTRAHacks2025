{% extends "layout.html" %}

{% block content %}
    <h1>{{ "Currently on: " + exercise_name }}</h1>
    <div id="output">
        <span id="rep_count">Waiting!!</span>
        <span id="cur"></span>
    </div>

    <!-- Add JavaScript to fetch the output when the page loads -->
    <script>
        // Create an EventSource to listen for updates from the /run-script route
        const exerciseName = "{{ exercise_name }}";  // Pass the exercise_name to JavaScript
        const eventSource = new EventSource("/run-script/" + exerciseName);

        eventSource.onmessage = function(event) {
            document.getElementById("cur").innerText = "Received: " + event.data;
        };

        // Handle errors
        eventSource.onerror = function(event) {
            console.error("EventSource failed.");
            document.getElementById('cur').innerText = "Failed to connect";
            eventSource.close();
        };

        // Function to trigger the run-script action
        function startExercise() {
            fetch("/start-exercise", { method: 'POST' })
                .then(response => response.text())
                .then(data => {
                    console.log("Exercise started:", data);
                })
                .catch(error => {
                    console.error("Error starting exercise:", error);
                });
        }
    </script>

    <!-- Button to start the exercise -->
    <button onclick="startExercise()">Start Exercise</button>
    <button onclick="window.location.href='{{ url_for('home') }}'">Back to Home</button>
{% endblock %}
